---
title: '操作系统中进程的概念'
output: pdf_document
---

## 操作系统中的进程
*写这章时，想起了去年在网上看到一道面试题，问进程和线程分别是什么，有什么区别，我当时自问，我答不上来，答不清楚，现在回头想想，这种问题如果面试时讲不清楚真的有点丢脸*

### 1.进程
简单来说，进程是程序的一次执行的过程，比如MySQL这个程序，执行service mysql start之后，MySQL这个进程便启动了，之后会接收客户端的请求，存取数据。除非手动停止或者出现错误，否则这个进程将一直持续运行，进程也不一定是长时间运行的，比如我们c++写一个helloworld，运行几毫秒，黑框一闪而过，这也是一个进程。
如果说程序是静态的，那么进程便是动态的，进程可以说是一个抽象的概念，描述了程序动态执行的性质。

#### 1.1 进程的基本特征
+ 动态性：进程具有生命过程，有诞生，消亡，可暂停也可运行，不同时刻可能处于不同的状态；
+ 并发性：多个不同的进程能够存在于同一内存中，一个进程可以与另一个进程并发地执行；（并发这一过程会产生非常多的问题，因此值得我们在后面研究）
+ 调度性：进程调度是现代操作系统都具有的基本能力，操作系统根据不同的策略在不同时刻不同条件下，为不同的进程提供资源。

#### 1.2 进程的状态
+ 运行：运行状态是理想的状态，是我们期望进程处于的状态，处于运行状态的进程一定占有硬件资源，并且被分配到了CPU。
+ 就绪：进程具有运行资格，但尚未获取到CPU时间和其他资源，一旦条件满足，则有机会进入运行状态。
+ 阻塞：阻塞状态的进程不具备执行条件，一般这个进程在等待某一事件。一个处于阻塞状态的进程必须满足条件，才可以进入就绪状态。

#### 1.3 进程状态的切换
![](http://zelcyan.cn/pic/getpic/ODk=)
如上图所示，进程在不同状态之间的转化有很多种情况他们的转换都是由于某种特定的事件的发生，
1. 新建→就绪
当启动一个程序时，操作系统也满足创建新进程的条件时，操作系统便会创建一个**新建状态**的进程加到就绪队列。
2. 就绪→运行
当处于就绪状态的进程被调度程序选中，赋予其需要的资源，该进程便转换为运行状态
3. 运行→阻塞
当进程需要等待某一事件以继续执行时，进程便转换为阻塞状态。这种状态的转换一般是由于需要其他进程的结果，比如IO操作
4. 阻塞→就绪
当阻塞态的进程需要的条件被满足，即进程等待的事件发生了，进程便被移入就绪队列，即转换为就绪状态
5. 运行→就绪
这种转换在分时系统中是频繁出现的，当运行状态的进程用完了分配给它的时间片，必须暂停运行，让出CPU，什么时候被重新选中才可以继续运行
6. 运行→终止
当进程完成其任务，或者被异常终止时，进程便转为终止状态。需要注意的是，终止状态的进程并不是立马消失了，而是继续留在系统中，由其父进程负责撤销（此处需要了解进程创建的过程）。

#### 1.4 进程实体以及进程的控制
***这节可以说是比较重要的地方，对操作系统中进程的数据结构，进程控制块PCB的了解，对进程的控制以及进程间通信的方式都有描述***
##### 1.4.1 进程的描述
前面说到，进程是程序运行的过程，是程序运行的抽象的概念体现，但我们操作系统中的的确确有进程这个东西啊，这应该怎么理解呢。我们要知道，虽然我们无法用实际的物体或者语句去描述进程，但我们既然抽象出了进程这个概念，那么就可以用一系列实体去代表他。在操作系统中，我们用进程映像来表达进程。这里我们需要了解PCB这个概念，即Process Control Block——进程控制块，PCB里存储了一个进程的所有信息，如**进程标识符、当前状态、队列指针、程序执行起始地址、优先级、CPU现场保护区**等内容。程序运行过程中也包含一系列的数据，并且需要一个或多个栈，所以进程映像由程序、数据、栈和PCB组成，即：
![](http://zelcyan.cn/pic/getpic/OTE=)

##### 1.4.2 进程的控制
进程是有生命周期的，包括产生、运行、暂停、终止，这些操作称为对进程的控制。进程控制是系统通过系统调用为用户提供了对进程的控制能力，这些特殊的系统调用我们称之为**原语**，共有四种原语：**进程创建，进程调度，进程阻塞，进程唤醒**；
1. 进程的创建
创建新进程需要调用创建进程的系统调用，如UNIX/Linux中的fork()
形式：create（..）
功能：创建一个具有指定标识符的进程，并建立PCB结构
2. 进程的撤销
进程完成任务或者希望终止自己时，需要执行撤销原语
形式：kill/exit
功能：撤销当前进程，将进程的PCB结构归还到PCB池，归还占用的所有资源给父进程。使控制转向进程调度
3. 进程的阻塞
当进程需要等待某一事件完成时，需要调用阻塞原语把自己挂起
形式：susp()
功能：暂停进程的运行，将进程加入到等待队列中，并使控制转向进程调度
4. 进程的唤醒
处于等待状态的进程期待的事件完成时，由发现者进程使用唤醒原语唤醒它
形式：wakeup(..)
功能：等待的事件到来时，唤醒等待该事件的所有进程 或者首进程
***进程创建和撤销这块有必要深入了解，比如Linux创建子进程时的写时复制技术，内存的分配等***

##### 1.4.3 进程在系统中的组织方式
进程由程序、数据和PCB组成，操作系统对进程的管理和调度主要是通过对PCB的管理实现的，由于PCB中存储了进程的优先级，状态等信息，调度程序可以很方便的管理进程。但任何结构都需要一定的数据结构来存储，PCB在操作系统中就有不同的组织方式：
1. 链接方式
根据进程的状态，将PCB链接成就绪队列、阻塞队列、运行队列和空白队列，根据优先级再对这些队列进行排列。当状态变更时，便将该PCB移到指定队列。
优点：直观，占用内存少
缺点：需要遍历队列
2. 索引方式
根据进程状态，建立几张索引表，分别存储不同的PCB，需要时直接在索引表中直接获取目标PCB的地址
优点：获取快速
缺点：索引表占用内存空间

##### 1.4.4 进程间的通信
在操作系统中，一个任务可能需要若干个进程协调完成，因此进程间需要相互通信，进程间通信的方式主要有三种：
1. 共享存储器
相互通信的进程共享某些数据结构或者共享存储区来交换数据。
2. 消息传递系统
以消息或者报文的形式，通过特定系统调用来向目标进程发送和接收消息
3. 管道通信
使用一个打开的共享文件来连接两个进程，该文件被称为管道。该机制具有1.互斥；2.同步；3判断对方是否存在；这三个协调能力。
